<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - LifeStream</title>
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>
<div class="container">
    <h1>Welcome, Admin ğŸ‘¨â€âš•ï¸</h1>

    <!-- âœ… Inventory Section -->
    <section>
        <h2>Blood Inventory</h2>
        <button onclick="loadInventory()">ğŸ”„ Refresh Inventory</button>
        <ul id="inventoryList"></ul>
    </section>

    <hr>

    <!-- âœ… Appointments Section -->
    <section>
        <h2>All Appointments</h2>
        <button onclick="loadAppointments()">ğŸ”„ Refresh Appointments</button>
        <ul id="apptList"></ul>
    </section>
</div>

<script>
    // âœ… Fetch Inventory
    async function loadInventory() {
        try {
            const res = await fetch("/api/inventory");
            const data = await res.json();

            const list = document.getElementById("inventoryList");
            list.innerHTML = "";

            if (data.length === 0) {
                list.innerHTML = "<li>No inventory records available.</li>";
            } else {
                data.forEach(item => {
                    const li = document.createElement("li");
                    li.textContent = `${item.bloodType}: ${item.units} units`;
                    list.appendChild(li);
                });
            }
        } catch (err) {
            alert("Error loading inventory: " + err.message);
        }
    }

    // âœ… Fetch Appointments
    async function loadAppointments() {
        try {
            const res = await fetch("/api/admin/appointments");
            const data = await res.json();

            const list = document.getElementById("apptList");
            list.innerHTML = "";

            if (data.length === 0) {
                list.innerHTML = "<li>No appointments scheduled.</li>";
            } else {
                data.forEach(a => {
                    const li = document.createElement("li");
                    li.innerHTML = `${a.donorId} â†’ ${a.appointmentTime} | Completed: ${a.completed}
                        ${!a.completed ? `<button onclick="completeAppt('${a.id}')">Mark Complete</button>` : ""}`;
                    list.appendChild(li);
                });
            }
        } catch (err) {
            alert("Error loading appointments: " + err.message);
        }
    }

    // âœ… Mark Appointment as Completed
    async function completeAppt(id) {
        const res = await fetch(`/api/admin/appointments/${id}/complete`, {
            method: "POST"
        });
        if (res.ok) {
            alert("âœ… Appointment marked completed!");
            loadAppointments();
        } else {
            alert("âŒ Failed to complete appointment.");
        }
    }

    // Load data on page load
    window.onload = () => {
        loadInventory();
        loadAppointments();
    };
</script>
</body>
</html>
